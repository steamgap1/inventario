<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockMaster - Gestión de Inventario</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    <!-- Bootstrap Icons CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>

    <!-- Barra de Navegación -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">StockMaster</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-route="products">Productos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-route="warranties">Garantías</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-route="providers">Proveedores</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-route="customers">Clientes</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-route="sales">Ventas</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-route="invoices">Facturas</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-route="quotes">Cotizaciones</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-route="reports">Reportes</a>
                    </li>
                </ul>
                <div class="d-flex">
                     <span id="user-info" class="navbar-text me-3"></span>
                    
                    <div class="dropdown me-3">
                        <button class="btn btn-link text-white p-0" type="button" id="notificationDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-bell-fill" style="font-size: 1.5rem;"></i>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="unread-notifications-badge" style="font-size: 0.6em;">
                                0
                                <span class="visually-hidden">unread messages</span>
                            </span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notificationDropdown" id="notifications-panel" style="width: 300px;">
                            <li><h6 class="dropdown-header">Notificaciones Recientes</h6></li>
                            <li><hr class="dropdown-divider"></li>
                            <div id="notifications-list">
                                <!-- Notifications will be rendered here -->
                                <li class="dropdown-item text-muted">No hay notificaciones.</li>
                            </div>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-center" href="#" data-route="notifications">Ver Todas las Notificaciones</a></li>
                        </ul>
                    </div>

                    <button id="logout-btn" class="btn btn-outline-light" style="display: none;">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <main class="container mt-4">
        <!-- App View -->
        <div id="alert-placeholder"></div>
        <div id="app-view">
            <!-- Aquí se renderizará el contenido dinámico (tablas, etc.) -->
        </div>
    </main>

    <!-- Modal Genérico para Formularios -->
    <div class="modal fade" id="form-modal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg"> <!-- Increased modal size for quote form -->
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modal-title"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modal-body">
                    <!-- El formulario se inyectará aquí -->
                </div>
            </div>
        </div>
    </div>

    <!-- Template para Fila de Producto -->
    <template id="product-row-template">
        <tr>
            <td data-label="ID"></td>
            <td data-label="Nombre"></td>
            <td data-label="Condición"></td>
            <td data-label="Stock"></td>
            <td data-label="Costo" class="admin-only"></td>
            <td data-label="P. Cliente" class="admin-only"></td>
            <td data-label="P. Mayorista" class="admin-only"></td>
            <td data-label="P. Técnico" class="admin-only"></td>
            <td data-label="Precio" class="non-admin-only"></td>
            <td data-label="Proveedor"></td>
            <td data-label="F. Entrada"></td>
            <td data-label="Garantía Exp."></td>
            <td data-label="Acciones" class="admin-only">
                <button class="btn btn-sm btn-warning edit-product-btn" data-id-edit>Editar</button>
                <button class="btn btn-sm btn-danger delete-product-btn" data-id-delete>Eliminar</button>
            </td>
        </tr>
    </template>

    <!-- Template para Fila de Proveedor -->
    <template id="provider-row-template">
        <tr>
            <td data-label="ID"></td>
            <td data-label="Nombre"></td>
            <td data-label="Contacto"></td>
            <td data-label="Teléfono"></td>
            <td data-label="Email"></td>
            <td data-label="Acciones" class="admin-only">
                <button class="btn btn-sm btn-warning edit-provider-btn" data-id-edit>Editar</button>
                <button class="btn btn-sm btn-danger delete-provider-btn" data-id-delete>Eliminar</button>
            </td>
        </tr>
    </template>

    <!-- Template para Fila de Garantía -->
    <template id="warranty-row-template">
        <tr>
            <td data-label="ID"></td>
            <td data-label="Producto"></td>
            <td data-label="Cliente"></td>
            <td data-label="Fecha Inicio"></td>
            <td data-label="Fecha Fin"></td>
            <td data-label="Estado"><span class="badge"></span></td>
            <td data-label="Notas"></td>
            <td data-label="Acciones" class="admin-only">
                <button class="btn btn-sm btn-warning edit-warranty-btn" data-id-edit>Editar</button>
                <button class="btn btn-sm btn-danger delete-warranty-btn" data-id-delete>Eliminar</button>
            </td>
        </tr>
    </template>

    <!-- Template para Fila de Venta -->
    <template id="sale-row-template">
        <tr>
            <td data-label="ID Venta"></td>
            <td data-label="Producto"></td>
            <td data-label="Cantidad"></td>
            <td data-label="Precio Venta"></td>
            <td data-label="Fecha Venta"></td>
            <td data-label="Cliente"></td>
            <td data-label="Notas"></td>
        </tr>
    </template>

    <!-- Template para Fila de Cotización -->
    <template id="quote-row-template">
        <tr>
            <td data-label="ID"></td>
            <td data-label="Cliente"></td>
            <td data-label="Fecha Cotización"></td>
            <td data-label="Válido Hasta"></td>
            <td data-label="Total"></td>
            <td data-label="Estado"></td>
            <td data-label="Acciones" class="admin-only">
                <button class="btn btn-sm btn-info view-quote-btn" data-id-view>Ver</button>
                <button class="btn btn-sm btn-warning edit-quote-btn" data-id-edit>Editar</button>
                <button class="btn btn-sm btn-danger delete-quote-btn" data-id-delete>Eliminar</button>
                <button class="btn btn-sm btn-success download-quote-btn" data-id-download>PDF</button>
            </td>
        </tr>
    </template>

    <!-- Template para Fila de Cliente -->
    <template id="customer-row-template">
        <tr>
            <td data-label="ID"></td>
            <td data-label="Identificación"></td>
            <td data-label="Nombre"></td>
            <td data-label="Teléfono"></td>
            <td data-label="Email"></td>
            <td data-label="Dirección"></td>
            <td data-label="Acciones" class="admin-only">
                <button class="btn btn-sm btn-warning edit-customer-btn" data-id-edit>Editar</button>
                <button class="btn btn-sm btn-danger delete-customer-btn" data-id-delete>Eliminar</button>
            </td>
        </tr>
    </template>

    <!-- Template para Formulario de Cliente -->
    <template id="customer-form-template">
        <form id="customer-form">
            <div class="mb-3">
                <label for="identification" class="form-label">Identificación</label>
                <input type="text" class="form-control" id="identification">
            </div>
            <div class="mb-3">
                <label for="name" class="form-label">Nombre</label>
                <input type="text" class="form-control" id="name" required>
            </div>
            <div class="mb-3">
                <label for="phone" class="form-label">Teléfono</label>
                <input type="text" class="form-control" id="phone">
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email">
            </div>
            <div class="mb-3">
                <label for="address" class="form-label">Dirección</label>
                <textarea class="form-control" id="address" rows="3"></textarea>
            </div>
            <div class="d-grid">
                <button type="submit" class="btn btn-primary">Guardar</button>
            </div>
        </form>
    </template>

    <!-- Template para Formulario de Producto -->
    <template id="product-form-template">
        <form id="product-form">
            <div class="mb-3">
                <label for="name" class="form-label">Nombre</label>
                <input type="text" class="form-control" id="name" required>
            </div>
            <div class="mb-3">
                <label for="description" class="form-label">Descripción</label>
                <textarea class="form-control" id="description" rows="3"></textarea>
            </div>
            <div class="mb-3">
                <label for="stock" class="form-label">Stock</label>
                <input type="number" class="form-control" id="stock" required>
            </div>
            <div class="mb-3">
                <label for="condition" class="form-label">Condición</label>
                <select class="form-select" id="condition" required>
                    <option value="nuevo">Nuevo</option>
                    <option value="usado">Usado</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="cost" class="form-label">Costo</label>
                <input type="number" step="0.01" class="form-control" id="cost" required>
            </div>
            <div class="mb-3">
                <label for="price_client" class="form-label">Precio Cliente</label>
                <input type="number" step="0.01" class="form-control" id="price_client" required>
            </div>
            <div class="mb-3">
                <label for="price_wholesale" class="form-label">Precio Mayorista</label>
                <input type="number" step="0.01" class="form-control" id="price_wholesale" required>
            </div>
            <div class="mb-3">
                <label for="price_technician" class="form-label">Precio Técnico</label>
                <input type="number" step="0.01" class="form-control" id="price_technician" required>
            </div>
            <div class="mb-3">
                <label for="provider_id" class="form-label">Proveedor</label>
                <select class="form-select" id="provider_id">
                    <option value="">-- Anónimo --</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="entry_date" class="form-label">Fecha de Entrada</label>
                <input type="date" class="form-control" id="entry_date">
            </div>
            <div class="mb-3">
                <label for="warranty_expires_on" class="form-label">Garantía Expira</label>
                <input type="date" class="form-control" id="warranty_expires_on">
            </div>
            <div class="d-grid">
                <button type="submit" class="btn btn-primary">Guardar</button>
            </div>
        </form>
    </template>

    <!-- Template para Formulario de Proveedor -->
    <template id="provider-form-template">
        <form id="provider-form">
            <div class="mb-3">
                <label for="name" class="form-label">Nombre</label>
                <input type="text" class="form-control" id="name" required>
            </div>
            <div class="mb-3">
                <label for="contact_person" class="form-label">Persona de Contacto</label>
                <input type="text" class="form-control" id="contact_person">
            </div>
            <div class="mb-3">
                <label for="phone" class="form-label">Teléfono</label>
                <input type="text" class="form-control" id="phone">
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email">
            </div>
            <div class="d-grid">
                <button type="submit" class="btn btn-primary">Guardar</button>
            </div>
        </form>
    </template>

    <!-- Template para Formulario de Garantía -->
    <template id="warranty-form-template">
        <form id="warranty-form">
            <div class="mb-3">
                <label for="product_id" class="form-label">Producto</label>
                <select class="form-select" id="product_id" required>
                    <option value="">Seleccione un producto...</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="customer_id" class="form-label">Cliente</label>
                <select class="form-select" id="customer_id" required>
                    <option value="">Seleccione un cliente...</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="start_date" class="form-label">Fecha de Inicio</label>
                <input type="date" class="form-control" id="start_date" required>
            </div>
            <div class="mb-3">
                <label for="end_date" class="form-label">Fecha de Fin</label>
                <input type="date" class="form-control" id="end_date" required>
            </div>
            <div class="mb-3">
                <label for="notes" class="form-label">Notas</label>
                <textarea class="form-control" id="notes" rows="3"></textarea>
            </div>
            <div class="mb-3">
                <label for="status" class="form-label">Estado</label>
                <select class="form-select" id="status">
                    <option value="activa">Activa</option>
                    <option value="expirada">Expirada</option>
                    <option value="reclamada">Reclamada</option>
                </select>
            </div>
            <div class="d-grid">
                <button type="submit" class="btn btn-primary">Guardar</button>
            </div>
        </form>
    </template>

    <!-- Template para Formulario de Cotización -->
    <template id="quote-form-template">
        <form id="quote-form">
            <div class="mb-3">
                <label for="customer_id" class="form-label">Cliente</label>
                <select class="form-select" id="customer_id" required>
                    <option value="">Seleccione un cliente...</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="valid_until" class="form-label">Válido Hasta (Opcional)</label>
                <input type="date" class="form-control" id="valid_until">
            </div>
            <div class="mb-3">
                <label for="notes" class="form-label">Notas de la Cotización (Opcional)</label>
                <textarea class="form-control" id="notes" rows="3"></textarea>
            </div>
            <div class="mb-3">
                <label for="status" class="form-label">Estado</label>
                <select class="form-select" id="status">
                    <option value="draft">Borrador</option>
                    <option value="sent">Enviada</option>
                    <option value="accepted">Aceptada</option>
                    <option value="rejected">Rechazada</option>
                    <option value="converted_to_sale">Convertida a Venta</option>
                </select>
            </div>

            <h4>Artículos de la Cotización</h4>
            <div id="quote-items-container">
                <!-- Quote items will be added here dynamically -->
            </div>
            <button type="button" class="btn btn-secondary btn-sm mt-2" id="add-quote-item-btn">Añadir Artículo</button>

            <div class="d-grid mt-3">
                <button type="submit" class="btn btn-primary">Guardar Cotización</button>
            </div>
        </form>
    </template>

    <!-- Template para un Artículo de Cotización (para añadir dinámicamente) -->
    <template id="quote-item-form-template">
        <div class="row g-2 align-items-end quote-item border rounded p-2 mb-2">
            <div class="col-md-5">
                <label class="form-label">Producto</label>
                <select class="form-select product-select" required>
                    <option value="">Seleccione producto...</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Cantidad</label>
                <input type="number" class="form-control item-quantity" value="1" min="1" required>
            </div>
            <div class="col-md-3">
                <label class="form-label">Precio Unitario</label>
                <input type="number" step="0.01" class="form-control item-unit-price" required>
            </div>
            <div class="col-md-2">
                <button type="button" class="btn btn-danger remove-item-btn">X</button>
            </div>
            <div class="col-12">
                <label class="form-label">Notas del Artículo (Opcional)</label>
                <textarea class="form-control item-notes" rows="1"></textarea>
            </div>
        </div>
    </template>

    <!-- Template para un Artículo de Venta (para añadir dinámicamente) -->
    <template id="sale-item-form-template">
        <div class="row g-2 align-items-end sale-item border rounded p-2 mb-2">
            <div class="col-md-5">
                <label class="form-label">Producto</label>
                <select class="form-select product-select" name="product_id" required>
                    <option value="">Seleccione producto...</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Cantidad</label>
                <input type="number" class="form-control item-quantity" name="quantity" value="1" min="1" required>
            </div>
            <div class="col-md-3">
                <label class="form-label">Precio Unitario</label>
                <input type="number" step="0.01" class="form-control item-unit-price" name="unit_price" required>
            </div>
            <div class="col-md-2">
                <button type="button" class="btn btn-danger remove-item-btn">X</button>
            </div>
        </div>
    </template>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- JS de la aplicación -->
    <script src="js/app.js" type="module"></script>
</body>
</html>